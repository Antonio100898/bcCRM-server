21/06/23 10:36  GetDataSet Exception Message: Must declare the scalar variable "@workerId".
. extraInfo: sql: SELECT TOP 50  problemsClose.id, problemsClose.workerId, problemsClose.phoneId, problemsClose.phone, problemsClose.ip, problemsClose.placeNameId, problemsClose.placeName, problemsClose.customerName, problemsClose.problemDesc, problemsClose.problemSolution, problemsClose.statusId, problemsClose.emergencyId, problemsClose.departmentId, problemsClose.reportToYaron, problemsClose.startTime, problemsClose.finishTime, problemStatus.statusName, workers.firstName + N' ' + workers.lastName AS workerName, departments.departmentName, problemsClose.toWorker, workers_1.firstName + N' ' + workers_1.lastName AS toWorkerName, workers_1.jobTitle as toWorkerJobTitle, tFiles.[fileCount], tFiles.filesName, problemWorkers.workerId as toWorkersId, updaterWorkerId, workers_2.firstName + N' ' + workers_2.lastName AS updateWorkerName, workers_2.wDepartmentId as updateWorkerDepartment, places.vip, problemsClose.takingCare, problemsClose.isLocked, problemsClose.callCustomerBack, problemTypesInfo, pt.pCount as isInvolved FROM problemsClose LEFT JOIN workers ON problemsClose.workerId = workers.id INNER JOIN problemStatus ON problemsClose.statusId = problemStatus.id INNER JOIN departments ON problemsClose.departmentId = departments.id LEFT JOIN workers AS workers_1 ON problemsClose.toWorker = workers_1.id LEFT JOIN workers AS workers_2 ON problemsClose.updaterWorkerId = workers_2.id LEFT JOIN places ON places.id = problemsClose.placeNameId LEFT JOIN (SELECT[problemId], Sum(1) as fileCount, STRING_AGG(ISNULL([filePath], ' '), ', ') As filesName FROM[dbo].[problemFiles] group by[problemId]) as tFiles on problemsClose.id = tFiles.[problemId] LEFT JOIN problemWorkers ON problemsClose.id = problemWorkers.problemId LEFT JOIN(SELECT[problemId], STRING_AGG (CONVERT(NVARCHAR(max),problemTypes.problemTypeName + '-' + color), ',') As problemTypesInfo FROM[dbo].problemTypeDetails  LEFT JOIN problemTypes ON problemTypeDetails.problemTypeId = problemTypes.id group by[problemId]) as tTypes on problemsClose.id = tTypes.[problemId] Left Join (SELECT problemWorkers.problemId, Sum(IIF(problemWorkers.workerId=@workerId,1,0)) as pCount FROM [dbo].[problemsClose] inner join problemWorkers on problemWorkers.problemId = [problemsClose].id WHERE statusId<>2 AND problemWorkers.workerId = @workerId Group by  problemWorkers.problemId) pt on problemsClose.id = pt.problemId WHERE (problemsClose.PlaceName LIKE N'%בדיקה%') AND (problemsClose.startTime > GETDATE() - 90) ORDER BY problemsClose.startTime DESC

